From 4d9f2f00d775be934b9d91fa8a06704a7e7e8a43 Mon Sep 17 00:00:00 2001
From: Parag Nemade <pnemade@fedoraproject.org>
Date: Wed, 23 Mar 2022 08:29:44 +0530
Subject: [PATCH] skip tests requiring network connectivity

---
 test/test_runtime.py         | 11 ++++++++---
 test/test_runtime_example.py |  2 ++
 2 files changed, 10 insertions(+), 3 deletions(-)

diff --git a/test/test_runtime_example.py b/test/test_runtime_example.py
index a9e106f..005cf89 100644
--- a/test/test_runtime_example.py
+++ b/test/test_runtime_example.py
@@ -1,7 +1,9 @@
 """Sample use of Runtime class."""
+import pytest
 from ansible_compat.runtime import Runtime
 
 
+@pytest.mark.skip(reason="external connectivity is disabled during the build process")
 def test_runtime_example() -> None:
     """Test basic functionality of Runtime class."""
     # instantiate the runtime using isolated mode, so installing new
diff --git a/test/test_runtime.py b/test/test_runtime.py
index fc69b86..ef62752 100644
--- a/test/test_runtime.py
+++ b/test/test_runtime.py
@@ -142,6 +142,7 @@ def test_runtime_install_role(
     runtime.cache_dir = tmp_dir
 
 
+@pytest.mark.skip(reason="external connectivity is disabled during the build process")
 def test_prepare_environment_with_collections(tmp_path: pathlib.Path) -> None:
     """Check that collections are correctly installed."""
     runtime = Runtime(isolated=True, project_dir=str(tmp_path))
@@ -207,8 +208,7 @@ def remember_cwd(cwd: str) -> Iterator[None]:
         os.chdir(curdir)
 
 
-# # https://github.com/box/flaky/issues/170
-@flaky(max_runs=3)  # type: ignore
+@pytest.mark.skip(reason="external connectivity is disabled during the build process")
 def test_prerun_reqs_v1(caplog: pytest.LogCaptureFixture, runtime: Runtime) -> None:
     """Checks that the linter can auto-install requirements v1 when found."""
     cwd = os.path.realpath(
@@ -228,7 +228,7 @@ def test_prerun_reqs_v1(caplog: pytest.LogCaptureFixture, runtime: Runtime) -> N
     )
 
 
-@flaky(max_runs=3)  # type: ignore
+@pytest.mark.skip(reason="external connectivity is disabled during the build process")
 def test_prerun_reqs_v2(caplog: pytest.LogCaptureFixture, runtime: Runtime) -> None:
     """Checks that the linter can auto-install requirements v2 when found."""
     cwd = os.path.realpath(
@@ -362,6 +362,7 @@ def test__update_env(
     assert runtime.environ["DUMMY_VAR"] == result
 
 
+@pytest.mark.skip(reason="external connectivity is disabled during the build process")
 def test_require_collection_wrong_version(runtime: Runtime) -> None:
     """Tests behaviour of require_collection."""
     subprocess.check_output(
@@ -407,6 +408,7 @@ def test_require_collection_preexisting_broken(tmp_path: pathlib.Path) -> None:
         runtime.require_collection("foo.bar")
 
 
+@pytest.mark.skip(reason="external connectivity is disabled during the build process")
 def test_require_collection(runtime_tmp: Runtime) -> None:
     """Check that require collection successful install case."""
     runtime_tmp.require_collection("community.molecule", "0.1.0")
@@ -436,6 +438,7 @@ def test_install_collection(runtime: Runtime) -> None:
     runtime.install_collection("containers.podman:>=1.0")
 
 
+@pytest.mark.skip(reason="external connectivity is disabled during the build process")
 def test_install_collection_dest(runtime: Runtime, tmp_path: pathlib.Path) -> None:
     """Check that valid collection to custom destination passes."""
     runtime.install_collection("containers.podman:>=1.0", destination=tmp_path)
@@ -522,6 +525,7 @@ def test_install_galaxy_role_no_checks(runtime_tmp: Runtime) -> None:
     assert result.returncode == 0, result
 
 
+@pytest.mark.skip(reason="external connectivity is disabled during the build process")
 def test_upgrade_collection(runtime_tmp: Runtime) -> None:
     """Check that collection upgrade is possible."""
     # ensure that we inject our tmp folders in ansible paths
@@ -539,6 +543,7 @@ def test_upgrade_collection(runtime_tmp: Runtime) -> None:
     runtime_tmp.require_collection("containers.podman", "1.6.1")
 
 
+@pytest.mark.skip(reason="external connectivity is disabled during the build process")
 def test_require_collection_no_cache_dir() -> None:
     """Check require_collection without a cache directory."""
     runtime = Runtime()
-- 
2.35.1

